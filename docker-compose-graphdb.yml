version: "3.9"

services:
  # --------------------- GraphDB service (standalone) ---------------------
  graphdb:
    # Use a valid public tag. "latest" generally points to the current GraphDB Free image.
    # If you prefer a pinned version, change to a specific tag (e.g., 10.6.4) that exists on Docker Hub.
    image: ontotext/graphdb:11.1.3
    environment:
      # Tune memory as needed for your EC2 instance
      GDB_HEAP_SIZE: 512m
#      GDB_HEAP_SIZE: 2g
#      GDB_MIN_MEM: 1g
#      GDB_MAX_MEM: 2g
    volumes:
      # Persistent GraphDB home (repositories, config)
      - graphdb-data:/opt/graphdb/home
      # Optional: logs/work if you want them persisted separately
      - graphdb-logs:/opt/graphdb/logs
      - graphdb-work:/opt/graphdb/work
      # Ontology bind mount for easy server-side import via Workbench (Import > Server files)
      # GraphDB Workbench shows files from /opt/graphdb/home/import
      - ./ontology:/opt/graphdb/home/import/ontology:rw
    ports:
      # Bind GraphDB only to localhost; fronted by host Nginx
      - "7200:7200"
    networks:
      - kg4dt_net
    container_name: graphdb
    restart: unless-stopped

volumes:
  graphdb-data:
  graphdb-logs:
  graphdb-work:

# Shared external network so this stack can be discovered by other compose files
networks:
  kg4dt_net:
    external: true
